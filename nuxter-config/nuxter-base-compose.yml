version: '3.8'

services:
  nuxt-app:
    container_name: ${APP_NAME}-${APP_ENV}-nuxt-app
    build: 
      context: .
      dockerfile: nuxter-config/Dockerfile.nuxt-app
      args:
        APP_NAME: ${APP_NAME}
        APP_ENV: ${APP_ENV}
    env_file: nuxter-config/nuxt-app.${APP_ENV}.env
    restart: unless-stopped
    networks:
      - caddy_nuxt_app
  pb-db:
    container_name: ${APP_NAME}-${APP_ENV}-pb-db
    build: 
      context: .
      dockerfile: nuxter-config/Dockerfile.pb-db
      args:
        PB_ENCRYPTION_KEY: ${PB_ENCRYPTION_KEY}
        APP_NAME: ${APP_NAME}
    restart: unless-stopped
    volumes:
      - pb_data:/pb/pb_data
    networks:
      - caddy_pb_db

volumes:
  pb_data:
    name: ${APP_NAME}_${APP_ENV}_pb_data

networks:
  caddy_nuxt_app:
    name: ${APP_NAME}_${APP_ENV}_caddy_nuxt_app
    external: true
  caddy_pb_db:
    name: ${APP_NAME}_${APP_ENV}_caddy_pb_db
    external: true